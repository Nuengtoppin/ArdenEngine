1. Purpose (Назначение)

Voxel Layer является ключевым источником данных мира.
Он хранит структурированную воксельную информацию, необходимую для:

визуальной реконструкции поверхности

вычисления состояний материалов

процедурной модификации геометрии (деструкция/строительство)

синхронной передачи данных в оптимизационные подсистемы

Voxel Layer не занимается физикой, логикой опор или поведением объектов.

2. Data Model (Модель данных)

Каждый воксель содержит:

Поле	Тип	Назначение	Обязательно
MaterialID	uint16	тип поверхности и параметров материала	✅
Density	uint8	0–255, определяет границу поверхности (изосёрфейс)	✅
Flags	uint8	расширяемая маска состояния: повреждение, жар, влага, стабильность	✅
Aux	optional	служебные расширения для будущих систем	❌ (MVP off)

Тип данных: Stateful Voxel
Семантика Density:

0 — пустота

1–255 — заполненность (порог визуализации хранится в материале)

3. Chunk Structure (Окточанки)

Базовая единица хранения: Octochunk 32×32×32

Идентификатор: (SectorID, LocalOctoIndex)

Каждая запись имеет:

RawData (воксели)

LOD-cache (упрощение поверхности на уровнях, генерируется лениво)

Чанк не хранит mesh постоянно.
Меш восстанавливается по запросу.

4. Active State Control (Управление состоянием)

Voxel Layer полностью подчиняется HAOS:

State	Geometry	Physics	DTO
Active	High LOD	Vector Layer	Синхронизация
Partial	Medium LOD	Proxy only	Background sync
Sleep	Hidden	Disabled	Might be queued
DTO Archive	No data**	No physics	Stored externally

RawData всегда доступен через DTO при необходимости

5. Surface Reconstruction (Восстановление поверхности)

Минимальные требования:

Marching Cubes / Meshing by Density

Обновление только изменённых регионов

Буферизация мешей в GPU

Поддержка границ между чанками (без швов)

LOD переключается моментально, сетка — из кеша.

6. Integration with Vector Layer

Voxel Layer сообщает Vector Layer:

зоны разрушений

обновлённые границы и материалы

состояние стабильности по флагам

необходимость пересоздания proxy-структур

Vector Layer обеспечивает физическую непрерывность,
пока Voxel Layer обновляет геометрию.

7. Integration with DTO

DTO хранит только:

RawData (воксели: MaterialID + Density + Flags)

Metadata (версия, хэш)

DTO не хранит:
-Mesh
-LOD Cache
-Физику

Очевидный принцип:

Истина – в вокселях. Всё остальное – производное.

8. Performance Strategy

Строгие ограничения:

не более N окточанков на перегенерацию за кадр

приоритеты определяет HAOS

логика Boundary Update — обновление только граничных районов при стыковке LOD

фоновые задачи выводятся в отдельный бюджет (потоки / async)

9. Role in Hybrid Architecture

Voxel Layer является единственным источником правды о мире
и не дублируется другими системами.

Его ответственность:

Что делает	Что не делает
хранит форму	не объясняет её
рендерит поверхность	не моделирует опоры
обрабатывает разрушения	не принимает решений
отдаёт данные HAOS / Vector	не оптимизирует сам
10. Foundation for Future Expansions

Модуль должен позволять добавить позже:

мульти-материальные воксели

биомные слои и ресурсы

жидкостную симуляцию (опционально отдельный слой)

анизотропные материалы (упругость, обломность)

ползучесть, огонь, проводимость

Миграция DTO поддержит расширение без переписывания данных.

✅ Итоговое назначение (официальное определение)

Voxel Layer хранит материю мира в самом надёжном виде.
Он даёт Vector Layer и HAOS возможность управлять поведением и оптимизацией,
оставаясь неизменным источником геометрической правды во вселенной Arden.
