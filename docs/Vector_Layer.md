Developer Visualization & Beacons
Отладочные наложения векторного слоя
Цель

Дать разработчику и подсистемам простой визуальный канал для понимания “смысла” мира: где проходят границы, какие узлы несут нагрузку, где установлены флаги событий и что именно сейчас важно для HAOS/DTO/AI.

1) Режимы отображения (три пресета)

Векторный слой отрисовывает поверх сцены отключаемые наложения. Переключение — мгновенное, без пересборки мешей.

Preset A — Vector Grid
Показывает только базовую векторную сетку и границы:

границы Attention-секторов;

контуры активных/частичных зон;

границы окточанков, задействованных в текущем кадре.

Preset B — Grid + Object Nodes
Добавляет узлы объектов и связей:

опорные точки, шарниры, якоря, “ребра опоры”;

направления доминирующих связей (упрощенно, без стрелок; только маркеры принадлежности);

точки потенциальной нестабильности (без оценок риска).

Preset C — Grid + Nodes + Beacons/Flags
Включает маяки/флаги событий и статуса:

флаги HAOS (смена состояния сектора, приоритеты);

флаги Vector Layer (потеря опоры, коллизия, деградация прочности);

флаги Voxel Layer (требуется пересборка локального меша, “грязная” область);

флаги DTO (архивирование/восстановление в очереди, ошибки валидации).

Все три пресета используют один и тот же канал данных, различается только видимость слоев.

2) Управление и UX

Рекомендуемые хоткеи (можно задать в конфиге):

F7 — переключатель Overlay ON/OFF (включить/выключить наложение целиком).

F8 — цикл пресетов: A → B → C → A.

Ctrl+F8 — быстрый выбор пресета по номеру (всплывающее меню).

Alt+F8 — “Focus Mode”: показать только объекты под прицелом/курсорной лучом.

F9 — панель фильтров (галочки типов маяков, уровни важности, владельцы).

Панель фильтров (минимум):

Типы: HAOS / Vector / Voxel / DTO / AI.

Важность: Critical / High / Normal / Low.

Жизненный цикл: Active / Pending / Resolved / Expired.

Область: Текущий сектор / Соседние / Все активные.

Производительность:

наложение рендерится отдельным бюджетом времени (например, ≤ 1.5 мс/кадр);

при перегрузе автоматически упрощает отрисовку (LOD линий, батчинг, клэмп количества видимых маяков).

3) Маяки и флаги (Beacons/Flags)
Назначение

Стандартизованный “пинг” от подсистем, фиксирующий событие, статус или запрос. Используется для визуальной диагностики, логирования и приоритизации задач.

Поля маяка (минимальный контракт)

id — уникальный идентификатор.

type — класс события (см. ниже).

owner — подсистема-владелец: HAOS | Vector | Voxel | DTO | AI.

sector_id — идентификатор сектора (если применимо).

chunk_ref — ссылка на окточанк или область (если применимо).

position — мировая позиция (центроид области/узла).

severity — critical | high | normal | low.

ttl_ms — время жизни; 0 означает “до вручную/автозавершения”.

message — короткое описание (≤ 80 символов).

tags[] — произвольные метки для фильтрации (например, boundary, collapse, archive).

Типы маяков (базовый набор)

HAOS: state_switch, budget_overrun, prewarm_request, sleep_transition.

Vector: support_loss, joint_overstress, proxy_update_required, stability_warning.

Voxel: mesh_rebuild_required, dirty_region, material_change.

DTO: archive_enqueued, restore_enqueued, validation_failed, version_mismatch.

AI: nav_blocked, nav_bridge_required, hazard_zone.

Жизненный цикл маяка

Active → (auto/manual) → Resolved → (optional) Archived

авто-закрытие по таймеру или по событию “выполнено”;

агрегатор объединяет частые повторы в один “батч-маяк” с счетчиком.

4) Узлы объектов (Object Nodes)

Что это: абстрактные опорные/функциональные точки векторного слоя, по которым строятся доминирующие связи и принимаются решения.

Примеры узлов:

Anchor: якорь опоры (балка к стене, колонна к основанию).

Joint: шарнир, соединение секций, петля двери.

Support: несущая точка свода/моста.

BoundaryNode: узел на шве сектора/окточанка.

ProxyCollider: представитель упрощенного коллайдера.

Свойства (минимум):

node_id, node_type, position, sector_id, links[] (связи с другими узлами), strength/stability (оценочное).

Отображение:

в пресете B/C показываются только маркеры узлов;

детализация значений (числа, подписи) включается отдельной галкой “Labels”.

5) Векторная сетка (Vector Grid)

Что это: логическая сетка векторного слоя, не равная сетке рендера и не привязанная жестко к шагу вокселей. Используется для:

обозначения границ Attention-секторов;

подсветки активной/частичной/спящей зон;

локализации граничных обновлений (boundary-updates);

упрощения отрисовки без меш-перегенерации.

Настройки:

видимость границ секторов;

видимость границ окточанков;

альфа-прозрачность;

“focus around player”: показывать только в радиусе N метров.

6) Интеграция с подсистемами

HAOS

Выставляет маяки по смене состояний, бюджетам, предзагрузке (“prewarm”).

Получает от Vector Layer “важность узла/зоны” для приоритизации.

Voxel Layer

Выставляет маяки “требуется пересборка/грязная область”.

Получает из Vector Layer привязки к узлам/границам для локального обновления.

DTO

Выставляет статусы “в очереди на архив/восстановление”, ошибки валидации.

Получает указания “что архивировать прежде всего” по приоритетам Vector/HAOS.

AI/Агенты

Читают узлы/маяки как подсказки навигации и риска.

Могут создавать свои маяки (например, “опасная зона”).

7) API (эскиз)
// Overlay control
Overlay.setEnabled(bool on);
Overlay.setPreset(enum { Grid, GridNodes, GridNodesBeacons });
Overlay.setFilter({ types[], owners[], severities[], lifespan, radius });

// Beacon
BeaconId Beacon.push(BeaconData data);
void      Beacon.resolve(BeaconId id);
void      Beacon.update(BeaconId id, BeaconData patch);

// Nodes
NodeId    Nodes.register(NodeData data);
void      Nodes.link(NodeId a, NodeId b, LinkProps props);
NodeData  Nodes.get(NodeId id);

// Telemetry (для профайла)
Stats     Overlay.getStats(); // draws, culled, ms

8) Производительность и безопасность

Рисуется в последней фазе кадра, поверх рендера, с собственным бюджетом времени.

Ограничение на количество одновременно видимых маяков (по важности).

Авто-сворачивание деталей при падении FPS.

Никаких побочных эффектов на симуляцию при включенном оверлее.

9) Конфигурация по умолчанию

Оверлей по умолчанию выключен.

Горячие клавиши: F7 — ON/OFF, F8 — цикл пресетов, F9 — фильтры.

Preset по умолчанию при включении: Grid.

Цвета/иконки типов маяков задаются через конфиг (UI-скин), не в коде.

10) Короткое резюме

Три уровня видимости: сетка → сетка+узлы → сетка+узлы+маяки.

Маяки/флаги — единый стандарт событий для HAOS/Vector/Voxel/DTO/AI.

Узлы — минимальные смысловые точки структуры (опоры, стыки, границы).

Всё управляется горячими клавишами и фильтрами, не влияя на симуляцию.

Делает отладку, анализ и приоритизацию задач быстрыми и наглядными.
